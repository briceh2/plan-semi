<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plan Semi â€” 10 mai 2026 (4 sÃ©ances)</title>
  <style>
    :root { --pad: 14px; }
    body {
      margin: 0; font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background: #f6f7f8; color: #111;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: white; border-bottom: 1px solid #e5e7eb;
      padding: 12px var(--pad);
    }
    h1 { font-size: 16px; margin: 0 0 6px 0; }
    .sub { font-size: 12px; color: #444; line-height: 1.35; }
    .wrap { padding: var(--pad); max-width: 980px; margin: 0 auto; }
    .card {
      background: white; border: 1px solid #e5e7eb; border-radius: 12px;
      padding: 12px; margin: 10px 0; box-shadow: 0 1px 0 rgba(0,0,0,.03);
    }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .pill {
      display: inline-block; font-size: 12px; padding: 4px 8px; border-radius: 999px;
      background: #eef2ff; color: #1f2a77;
    }
    .phase { background: #ecfeff; color: #155e75; }
    .warn { background: #fff7ed; color: #9a3412; }
    .ok { background: #ecfdf5; color: #065f46; }
    .kpi { font-size: 12px; color: #111; margin-top: 8px; line-height: 1.35; }
    .kpi strong { font-size: 13px; }

    /* Tabs */
    .tabs { display: flex; gap: 8px; margin-top: 10px; }
    .tab {
      flex: 1; text-align: center; padding: 10px 12px; border-radius: 12px;
      border: 1px solid #e5e7eb; background: #fff; font-weight: 700; font-size: 14px;
    }
    .tab.active { background: #111827; color: #fff; border-color: #111827; }
    .hidden { display:none; }

    details summary {
      cursor: pointer; font-weight: 800; font-size: 14px; list-style: none;
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
    }
    details summary::-webkit-details-marker { display: none; }
    .meta { font-size: 12px; color: #444; margin-top: 6px; line-height: 1.35; }

    .session {
      border-top: 1px dashed #e5e7eb; padding-top: 10px; margin-top: 10px;
    }
    .s-title { font-weight: 800; margin: 0 0 6px 0; }
    label.cb { display: flex; align-items: flex-start; gap: 10px; }
    input[type="checkbox"] { width: 22px; height: 22px; margin-top: 2px; }
    textarea, input[type="number"] {
      width: 100%; border: 1px solid #d1d5db; border-radius: 10px; padding: 10px;
      font-size: 14px; box-sizing: border-box; background: #fff;
    }
    textarea { min-height: 64px; resize: vertical; }
    .grid3 { display: grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 720px) { .grid3 { grid-template-columns: 1fr 2fr 2fr; } }

    .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    button {
      border: 1px solid #d1d5db; background: #fff; border-radius: 10px;
      padding: 10px 12px; font-size: 14px;
    }
    button.primary { background: #111827; color: #fff; border-color: #111827; }

    /* Stats mini chart */
    .barwrap { display: grid; gap: 8px; margin-top: 10px; }
    .barrow { display: grid; grid-template-columns: 54px 1fr 46px; gap: 10px; align-items: center; }
    .bar { height: 10px; border-radius: 999px; background: #e5e7eb; overflow: hidden; }
    .bar > span { display:block; height: 100%; width: 0%; background: #111827; }
    .muted { color:#555; font-size:12px; }
    .two { display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 720px){ .two { grid-template-columns: 1fr 1fr; } }
    .list { margin: 8px 0 0; padding-left: 18px; }
  </style>
</head>
<body>
<header>
  <h1>Plan Semi â€” dimanche 10 mai 2026</h1>
  <div class="sub">
    DÃ©but : <b>lundi 2 fÃ©vrier 2026</b> â€¢ Jours : <b>Mar / Jeu / Sam / Dim</b><br>
    Objectif : <b>1h45 (5â€™00/km)</b> â€¢ Bonus : <b>1h43â€“1h44</b>
  </div>

  <div class="tabs">
    <button class="tab active" id="tabPlan" aria-selected="true">Plan</button>
    <button class="tab" id="tabStats" aria-selected="false">Stats</button>
    <button class="tab" id="tabNutri" aria-selected="false">Nutrition</button>
  </div>

  <div class="kpi" id="kpi"></div>
</header>

<div class="wrap">
  <div class="card">
    <div class="row">
      <span class="pill">ğŸ’¾ Sauvegarde auto</span>
      <span class="pill phase">ğŸ›¡ï¸ Pas 2 sÃ©ances dures dâ€™affilÃ©e</span>
      <span class="pill" id="countdownPill">â³ â€”</span>
      <span class="pill" id="fatiguePill">â€”</span>
    </div>

    <div class="btns">
      <button class="primary" id="exportBtn">Exporter mes donnÃ©es (JSON)</button>
      <button id="importBtn">Importer (JSON)</button>
      <button id="resetBtn">RÃ©initialiser tout</button>
    </div>
    <div class="meta">
      iPhone : Safari â†’ Partager â†’ <b>Sur lâ€™Ã©cran dâ€™accueil</b> (icÃ´ne comme une app).
    </div>
    <input type="file" id="fileInput" accept="application/json" style="display:none" />
  </div>

  <!-- PLAN -->
  <section id="planSection">
    <div id="weeks"></div>
  </section>

  <!-- STATS -->
  <section id="statsSection" class="hidden">
    <div class="card">
      <div class="row">
        <span class="pill" id="globalPill">â€”</span>
        <span class="pill" id="sleepPill">â€”</span>
        <span class="pill" id="painPill">â€”</span>
      </div>

      <div class="two">
        <div>
          <div class="s-title">Progression (sÃ©ances cochÃ©es / 4)</div>
          <div class="muted">Chaque ligne = une semaine.</div>
          <div id="bars" class="barwrap"></div>
        </div>
        <div>
          <div class="s-title">Alerte fatigue</div>
          <ul class="list" id="fatigueList"></ul>
          <div class="muted" style="margin-top:10px;">
            Si alerte orange/rouge : transforme la prochaine sÃ©ance qualitÃ© en footing facile.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- NUTRITION -->
  <section id="nutriSection" class="hidden">
    <div class="card">
      <div class="s-title">ğŸ½ï¸ PrÃ©conisations alimentation & hydratation (liÃ©es au plan)</div>

      <div class="session">
        <div class="s-title">Semaines 1â€“5 â€” Base & Moteur</div>
        <ul class="list">
          <li>Objectif : rÃ©cupÃ©rer + construire (pas de â€œrÃ©gimeâ€).</li>
          <li>Ã€ chaque repas : <b>glucides + protÃ©ines</b> (riz/pÃ¢tes/pain + Å“ufs/poisson/volaille/lÃ©gumineuses).</li>
          <li>Hydratation : <b>1 verre dâ€™eau Ã  chaque repas</b> + 1 Ã  2 verres dans lâ€™aprÃ¨s-midi.</li>
          <li>AprÃ¨s VMA/tempo : collation <b>glucides + protÃ©ines</b> (banane + yaourt / tartines + fromage).</li>
        </ul>
      </div>

      <div class="session">
        <div class="s-title">Semaines 6â€“12 â€” SpÃ©cifique semi</div>
        <ul class="list">
          <li>Objectif : apprendre Ã  â€œtenirâ€ lâ€™allure et tester le ravito.</li>
          <li>La veille de la sortie longue : repas plus riche en <b>glucides digestes</b> (pÃ¢tes/riz/pdt, peu de gras).</li>
          <li>Sortie longue : teste <b>1 gel au km 9â€“11 + eau</b> (toujours avec eau).</li>
          <li>Ã€ lâ€™entraÃ®nement : petites gorgÃ©es rÃ©guliÃ¨res, ne bois pas dâ€™un coup.</li>
        </ul>
      </div>

      <div class="session">
        <div class="s-title">Semaines 13â€“14 â€” AffÃ»tage + course</div>
        <ul class="list">
          <li>Objectif : arriver â€œplein dâ€™Ã©nergieâ€ et lÃ©ger au niveau digestif.</li>
          <li>J-3 Ã  J-1 : augmente les glucides, baisse fibres/gras, Ã©vite les nouveautÃ©s.</li>
          <li><b>Hydratation</b> : rÃ©guliÃ¨re, urine claire (sans excÃ¨s).</li>
        </ul>
      </div>

      <div class="session">
        <div class="s-title">ğŸ Jour J (dimanche 10 mai 2026)</div>
        <ul class="list">
          <li>Petit-dÃ©j (2h30â€“3h avant) : <b>pain blanc + miel/confiture + banane + 300â€“500 ml eau</b>.</li>
          <li>15 min avant : 2â€“3 gorgÃ©es dâ€™eau.</li>
          <li>En course : <b>2â€“3 gorgÃ©es tous les ~5 km</b> (Ã  chaque ravito si chaleur).</li>
          <li><b>Gel au km 9â€“11</b> + eau juste aprÃ¨s.</li>
          <li>StratÃ©gie allure (1h45) : km 1â€“3 Ã  5â€™05, km 4â€“18 Ã  5â€™00, dernier tiers si OK â†’ 4â€™55.</li>
          <li>AprÃ¨s : eau + glucides + protÃ©ines dans lâ€™heure.</li>
        </ul>
      </div>
    </div>
  </section>
</div>

<script>
  // === Dates ===
  const START = new Date("2026-02-02T00:00:00");      // lundi 2 fÃ©vrier 2026
  const RACE  = new Date("2026-05-10T00:00:00");      // dimanche 10 mai 2026
  const WEEKS = 14;                                   // S1: 2-8 fÃ©v ... S14: 4-10 mai (course)

  function fmtDate(d){
    return d.toLocaleDateString("fr-FR", { day:"2-digit", month:"short", year:"numeric" });
  }
  function addDays(d, n){ const x = new Date(d); x.setDate(x.getDate()+n); return x; }

  // === Phases ===
  function phaseForWeek(w){
    if (w <= 5) return "Base & Moteur";
    if (w <= 12) return "SpÃ©cifique Semi";
    return "AffÃ»tage";
  }

  // === SÃ©ances (structure fixe) ===
  function sessionsForWeek(w){
    // On reste cohÃ©rent et simple, mais tu peux affiner ensuite si tu veux (progression des blocs).
    if (w <= 5) {
      return {
        tue: "VMA : 2 Ã— (8 Ã— 30s rapide / 30s lent) (rapide ~4â€™05â€“4â€™15/km)",
        thu: "Tempo : 3 Ã— 8 min Ã  5â€™10â€“5â€™05/km (rÃ©cup 2 min)",
        sat: "Endurance facile : 45â€“60 min (5â€™50â€“6â€™20/km) + 6 lignes droites",
        sun: "Sortie longue : 1h20â€“1h35 (facile)"
      };
    } else if (w <= 12) {
      return {
        tue: "VMA : 10 Ã— 400 m Ã  ~4â€™10/km (rÃ©cup 1â€™15)",
        thu: "Allure semi : 2â€“3 Ã— 15 min Ã  5â€™00/km (rÃ©cup 3 min)",
        sat: "Endurance facile : 50â€“60 min + 6 lignes droites",
        sun: "Sortie longue : 1h30â€“1h45 avec blocs Ã  5â€™00/km (tester gel km 9â€“11)"
      };
    } else if (w === 13) {
      return {
        tue: "Rappel : 6 Ã— 200 m rapide (rÃ©cup 1 min) + footing facile",
        thu: "Allure semi : 2 Ã— 10 min Ã  5â€™00/km (rÃ©cup 3 min)",
        sat: "40â€“50 min trÃ¨s facile",
        sun: "1h05â€“1h15 facile (sans forcer)"
      };
    } else { // w === 14
      return {
        tue: "Footing 40â€“45 min + 4 lignes droites",
        thu: "Rappel : 8â€“10 min allure semi (sans fatigue) + retour au calme",
        sat: "25â€“35 min trÃ¨s facile (optionnel si fatigue)",
        sun: "ğŸ SEMI-MARATHON (10 mai) â€” Objectif 1h45 (5â€™00/km) â€¢ Gel km 9â€“11 + eau"
      };
    }
  }

  // === Persistence ===
  const KEY = "planSemiData_v4";
  const defaultData = { weeks: {} };

  function loadData(){
    try {
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : defaultData;
    } catch { return defaultData; }
  }
  function saveData(){
    localStorage.setItem(KEY, JSON.stringify(data));
    updateAll();
  }

  const data = loadData();

  function ensureWeek(week){
    if (!data.weeks[week]) {
      data.weeks[week] = {
        done: { tue:false, thu:false, sat:false, sun:false },
        sleep: "",
        feel: "",
        pain: ""
      };
    }
  }

  // === Countdown ===
  function updateCountdown(){
    const today = new Date();
    const ms = RACE - new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const daysLeft = Math.ceil(ms / (1000*60*60*24));
    let pill = document.getElementById("countdownPill");

    if (daysLeft > 0){
      const weeksLeft = Math.floor(daysLeft / 7);
      const extraDays = daysLeft % 7;
      pill.textContent = `â³ Course dans ${weeksLeft} sem + ${extraDays} j (=${daysLeft} jours)`;
      pill.className = "pill";
    } else if (daysLeft === 0){
      pill.textContent = "ğŸ Câ€™est aujourdâ€™hui !";
      pill.className = "pill ok";
    } else {
      pill.textContent = "âœ… Course passÃ©e";
      pill.className = "pill ok";
    }
  }

  // === KPI + fatigue (simple) ===
  function computeKPI(){
    let total = 0, done = 0, painWeeks = 0, sleepLowWeeks = 0;
    for (let w=1; w<=WEEKS; w++){
      ensureWeek(w);
      const d = data.weeks[w].done;
      const count = ["tue","thu","sat","sun"].reduce((a,k)=>a+(d[k]?1:0),0);
      total += 4; done += count;

      const pain = (data.weeks[w].pain || "").trim();
      if (pain.length >= 3) painWeeks++;

      const sleep = parseFloat(String(data.weeks[w].sleep || "").replace(",", "."));
      if (!Number.isNaN(sleep) && sleep > 0 && sleep < 6) sleepLowWeeks++;
    }
    const pct = total ? Math.round(done*100/total) : 0;
    return { total, done, pct, painWeeks, sleepLowWeeks };
  }

  function currentWeekIndex(){
    const today = new Date();
    const base = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const ms = base - START;
    const days = Math.floor(ms / (1000*60*60*24));
    if (days < 0) return 0;
    return Math.floor(days / 7) + 1;
  }

  function fatigueStatus(){
    const w = currentWeekIndex();
    if (w < 1 || w > WEEKS) return { level:"ok", label:"ğŸŸ¢ RAS (hors pÃ©riode)", reasons:["Hors des 14 semaines."] };

    ensureWeek(w);
    const d = data.weeks[w].done;
    const count = ["tue","thu","sat","sun"].reduce((a,k)=>a+(d[k]?1:0),0);
    const pain = (data.weeks[w].pain || "").trim().length >= 3;
    const sleep = parseFloat(String(data.weeks[w].sleep || "").replace(",", "."));
    const sleepLow = (!Number.isNaN(sleep) && sleep > 0 && sleep < 6);

    const reasons = [];
    if (pain) reasons.push("Douleurs renseignÃ©es cette semaine.");
    if (sleepLow) reasons.push("Sommeil < 6h cette semaine.");
    if (count === 4) reasons.push("4 sÃ©ances cochÃ©es : OK si rÃ©cupÃ©ration bonne.");

    if ((pain && count >= 3) || (sleepLow && count >= 3)){
      return { level:"warn", label:"ğŸ”´ Vigilance (allÃ¨ge)", reasons: reasons.length?reasons:["Charge Ã©levÃ©e avec signaux faibles."] };
    }
    if (pain || sleepLow){
      return { level:"warn", label:"ğŸŸ  Attention (prudence)", reasons: reasons.length?reasons:["Surveille la rÃ©cup."] };
    }
    return { level:"ok", label:"ğŸŸ¢ OK (continue)", reasons:["Bon Ã©quilibre charge / rÃ©cupÃ©ration."] };
  }

  // === Render Plan ===
  const weeksEl = document.getElementById("weeks");

  function renderPlan(){
    weeksEl.innerHTML = "";
    for (let w=1; w<=WEEKS; w++){
      ensureWeek(w);

      const weekStart = addDays(START, (w-1)*7);
      const weekEnd = addDays(weekStart, 6);
      const phase = phaseForWeek(w);
      const s = sessionsForWeek(w);
      const state = data.weeks[w];

      const card = document.createElement("div");
      card.className = "card";

      const details = document.createElement("details");
      details.open = (w <= 2);

      const summary = document.createElement("summary");
      summary.innerHTML = `<span>Semaine ${w} â€” ${fmtDate(weekStart)} â†’ ${fmtDate(weekEnd)}</span>
                           <span class="pill phase">${phase}</span>`;
      details.appendChild(summary);

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = (w === 14)
        ? "Semaine de course : on garde de la fraÃ®cheur. Dimanche = semi-marathon."
        : "Cases Ã  cocher + notes (sauvegarde automatique).";
      details.appendChild(meta);

      const sessions = [
        ["tue","Mardi", s.tue],
        ["thu","Jeudi", s.thu],
        ["sat","Samedi", s.sat],
        ["sun","Dimanche", s.sun],
      ];

      sessions.forEach(([key, day, text]) => {
        const sec = document.createElement("div");
        sec.className = "session";
        sec.innerHTML = `
          <div class="s-title">${day}</div>
          <label class="cb">
            <input type="checkbox" ${state.done[key] ? "checked" : ""} data-week="${w}" data-key="${key}">
            <span>${text}</span>
          </label>
        `;
        details.appendChild(sec);
      });

      // Notes
      const notes = document.createElement("div");
      notes.className = "session";
      notes.innerHTML = `
        <div class="s-title">Notes de la semaine</div>
        <div class="grid3">
          <div>
            <div class="meta">Sommeil (heures)</div>
            <input type="number" min="0" step="0.5" inputmode="decimal"
              value="${state.sleep}" data-week="${w}" data-field="sleep" placeholder="ex: 7.5" />
          </div>
          <div>
            <div class="meta">Sensations</div>
            <textarea data-week="${w}" data-field="feel" placeholder="ex: bonnes jambes, sÃ©ance facile...">${state.feel || ""}</textarea>
          </div>
          <div>
            <div class="meta">Douleurs</div>
            <textarea data-week="${w}" data-field="pain" placeholder="ex: lÃ©gÃ¨re gÃªne mollet droit...">${state.pain || ""}</textarea>
          </div>
        </div>
      `;
      details.appendChild(notes);

      card.appendChild(details);
      weeksEl.appendChild(card);
    }

    // Wire events
    weeksEl.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.addEventListener("change", (e) => {
        const w = e.target.getAttribute("data-week");
        const k = e.target.getAttribute("data-key");
        ensureWeek(w);
        data.weeks[w].done[k] = e.target.checked;
        saveData();
      });
    });

    weeksEl.querySelectorAll('textarea, input[type="number"]').forEach(el => {
      el.addEventListener("input", (e) => {
        const w = e.target.getAttribute("data-week");
        const f = e.target.getAttribute("data-field");
        ensureWeek(w);
        data.weeks[w][f] = e.target.value;
        saveData();
      });
    });
  }

  // === Render Stats ===
  const barsEl = document.getElementById("bars");
  const fatiguePillEl = document.getElementById("fatiguePill");
  const fatigueListEl = document.getElementById("fatigueList");

  function renderStats(){
    const k = computeKPI();
    document.getElementById("globalPill").textContent = `Global : ${k.done}/${k.total} sÃ©ances (${k.pct}%)`;
    document.getElementById("sleepPill").textContent = `Semaines sommeil <6h : ${k.sleepLowWeeks}`;
    document.getElementById("painPill").textContent = `Semaines avec douleurs : ${k.painWeeks}`;

    barsEl.innerHTML = "";
    for (let w=1; w<=WEEKS; w++){
      ensureWeek(w);
      const d = data.weeks[w].done;
      const count = ["tue","thu","sat","sun"].reduce((a,k)=>a+(d[k]?1:0),0);
      const pct = Math.round(count*100/4);

      const row = document.createElement("div");
      row.className = "barrow";
      row.innerHTML = `
        <div class="muted">S${w}</div>
        <div class="bar"><span style="width:${pct}%"></span></div>
        <div class="muted">${count}/4</div>
      `;
      barsEl.appendChild(row);
    }

    const f = fatigueStatus();
    fatiguePillEl.textContent = f.label;
    fatiguePillEl.className = "pill " + (f.level === "ok" ? "ok" : "warn");

    fatigueListEl.innerHTML = "";
    f.reasons.forEach(r=>{
      const li = document.createElement("li");
      li.textContent = r;
      fatigueListEl.appendChild(li);
    });
  }

  // === Header KPI ===
  function updateHeaderKPI(){
    const k = computeKPI();
    const w = currentWeekIndex();
    const scope = (w>=1 && w<=WEEKS) ? `Semaine en cours : <strong>S${w}</strong> â€¢ ` : "";
    document.getElementById("kpi").innerHTML =
      `${scope}Suivi : <strong>${k.done}/${k.total}</strong> sÃ©ances cochÃ©es â€¢ <strong>${k.pct}%</strong>`;
  }

  // === Tabs ===
  function show(which){
    const plan = document.getElementById("planSection");
    const stats = document.getElementById("statsSection");
    const nutri = document.getElementById("nutriSection");

    plan.classList.add("hidden"); stats.classList.add("hidden"); nutri.classList.add("hidden");
    document.getElementById("tabPlan").classList.remove("active");
    document.getElementById("tabStats").classList.remove("active");
    document.getElementById("tabNutri").classList.remove("active");

    if (which === "plan"){ plan.classList.remove("hidden"); document.getElementById("tabPlan").classList.add("active"); }
    if (which === "stats"){ stats.classList.remove("hidden"); document.getElementById("tabStats").classList.add("active"); }
    if (which === "nutri"){ nutri.classList.remove("hidden"); document.getElementById("tabNutri").classList.add("active"); }

    window.scrollTo({top:0, behavior:"smooth"});
  }
  document.getElementById("tabPlan").onclick = ()=>show("plan");
  document.getElementById("tabStats").onclick = ()=>show("stats");
  document.getElementById("tabNutri").onclick = ()=>show("nutri");

  // === Export / Import / Reset ===
  document.getElementById("exportBtn").addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "plan-semi-donnees.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  document.getElementById("importBtn").addEventListener("click", () => {
    document.getElementById("fileInput").click();
  });

  document.getElementById("fileInput").addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    try {
      const txt = await file.text();
      const parsed = JSON.parse(txt);
      if (!parsed || typeof parsed !== "object" || !parsed.weeks) throw new Error("Format invalide");
      localStorage.setItem(KEY, JSON.stringify(parsed));
      location.reload();
    } catch (err) {
      alert("Import impossible : fichier invalide.");
    }
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    if (!confirm("RÃ©initialiser toutes les cases et notes ?")) return;
    localStorage.removeItem(KEY);
    location.reload();
  });

  // === Update all ===
  function updateAll(){
    updateCountdown();
    updateHeaderKPI();
    renderStats();
  }

  // Initial render
  renderPlan();
  updateAll();

  // Update countdown daily (and if you keep the page open)
  setInterval(updateCountdown, 60 * 60 * 1000);
</script>
</body>
</html>
